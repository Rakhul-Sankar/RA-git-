<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Past Reports - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-emerald-50 to-green-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white/90 backdrop-blur-md shadow-xl border-b sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-2xl font-bold text-gray-800 hover:text-green-600 transition-colors">â† Dashboard</a>
                </div>
                <div class="flex space-x-4">
                    <a href="index.html" class="text-gray-700 hover:text-purple-600 font-medium px-4 py-2 rounded-lg transition-all hover:bg-purple-50">Home</a>
                    <a href="profile.html" class="text-gray-700 hover:text-blue-600 font-medium px-4 py-2 rounded-lg transition-all hover:bg-blue-50">Profile</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Test Buttons -->
    <div class="fixed top-4 right-4 z-50 space-y-2">
        <button id="testAdd" class="bg-green-600 text-white px-6 py-3 rounded-2xl font-bold shadow-xl hover:shadow-2xl hover:scale-105 transition-all text-sm">
            ğŸ§ª Add Resume
        </button>
        <button id="testClear" class="bg-red-500 text-white px-6 py-3 rounded-2xl font-bold shadow-xl hover:shadow-2xl hover:scale-105 transition-all text-sm">
            ğŸ—‘ï¸ Clear All
        </button>
    </div>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-6 py-12">
        <div class="text-center mb-16">
            <h1 class="text-5xl font-black bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 bg-clip-text text-transparent mb-6 drop-shadow-lg">
                ğŸ“Š Resume Storage
            </h1>
            <p class="text-xl text-gray-700 max-w-2xl mx-auto leading-relaxed">âœ… Storage working! Click test buttons + upload from upload.html</p>
        </div>

        <!-- Controls -->
        <div class="bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl p-8 mb-12 border border-white/50">
            <div class="flex flex-col lg:flex-row gap-4 items-center justify-between">
                <input type="text" id="searchInput" placeholder="ğŸ” Search resumes..." 
                       class="w-full lg:w-96 pl-12 pr-4 py-4 bg-white/50 border-2 border-gray-200 rounded-2xl focus:border-purple-500 focus:outline-none transition-all text-lg shadow-inner">
                <div class="absolute left-20 top-36 lg:left-80 text-gray-400 text-lg">ğŸ”</div>
                <button id="clearAllBtn" class="px-8 py-4 bg-red-500/90 text-white font-bold rounded-2xl hover:bg-red-600 shadow-lg transition-all hover:scale-105">
                    ğŸ—‘ï¸ Clear All
                </button>
                <a href="upload.html" class="px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold rounded-2xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all">
                    â• Upload New
                </a>
            </div>
        </div>

        <!-- Stats -->
        <div class="grid md:grid-cols-4 gap-6 mb-12">
            <div class="bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border border-white/50 hover:shadow-3xl transition-all group">
                <div id="totalResumes" class="text-4xl font-black text-blue-600 mb-2 group-hover:scale-110 transition-transform">0</div>
                <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Total Stored</div>
            </div>
            <div class="bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border border-white/50 hover:shadow-3xl transition-all group">
                <div id="analyzedCount" class="text-4xl font-black text-green-600 mb-2 group-hover:scale-110 transition-transform">0</div>
                <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide">AI Analyzed</div>
            </div>
            <div class="bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border border-white/50 hover:shadow-3xl transition-all group">
                <div id="pendingCount" class="text-4xl font-black text-yellow-500 mb-2 group-hover:scale-110 transition-transform">0</div>
                <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Pending</div>
            </div>
            <div class="bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border border-white/50 hover:shadow-3xl transition-all group">
                <div id="storageUsed" class="text-4xl font-black text-purple-600 mb-2 group-hover:scale-110 transition-transform">0KB</div>
                <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Storage</div>
            </div>
        </div>

        <!-- Debug -->
        <div id="debugInfo" class="bg-yellow-100 border-2 border-yellow-400 rounded-2xl p-6 mb-8 text-sm">
            <strong>ğŸ” LIVE STATUS:</strong> <span id="debugText">Loading...</span>
        </div>

        <!-- Grid -->
        <div id="resumeGrid" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            <!-- Dynamic -->
        </div>
    </main>

    <script>
        // âœ… FULLY WORKING STORAGE SYSTEM
        const storage = {
            key: 'advancedResumes_v2',
            resumes: [],
            
            init() {
                console.log('ğŸš€ Storage init');
                this.load();
                this.events();
                setInterval(() => this.load(), 1000); // Auto-sync
            },

            load() {
                try {
                    const data = localStorage.getItem(this.key);
                    this.resumes = data ? JSON.parse(data) : [];
                    console.log('ğŸ“¦ Loaded:', this.resumes.length);
                } catch(e) {
                    this.resumes = [];
                }
                this.render();
                this.stats();
                this.debug();
            },

            save() {
                localStorage.setItem(this.key, JSON.stringify(this.resumes.slice(0, 50)));
                console.log('ğŸ’¾ Saved:', this.resumes.length);
            },

            add(name = 'Test.pdf') {
                const resume = {
                    id: Date.now() + Math.random().toString(36).substr(2, 9),
                    name, filename: name,
                    date: new Date().toLocaleDateString('en-CA'),
                    score: Math.floor(Math.random() * 30) + 70,
                    status: 'pending',
                    type: 'New Upload'
                };
                this.resumes.unshift(resume);
                this.save();
            },

            del(id) {
                if(confirm('Delete?')) {
                    this.resumes = this.resumes.filter(r => r.id !== id);
                    this.save();
                    this.render();
                }
            },

            render(resumes = this.resumes) {
                const grid = document.getElementById('resumeGrid');
                if(!resumes.length) {
                    grid.innerHTML = `
                        <div class="md:col-span-full text-center py-24 px-8">
                            <div class="w-32 h-32 bg-gradient-to-br from-gray-200 to-gray-300 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-2xl">
                                <span class="text-5xl">ğŸ“„</span>
                            </div>
                            <h2 class="text-4xl font-black text-gray-700 mb-4">No Resumes</h2>
                            <p class="text-xl text-gray-500 mb-8">Click ğŸ§ª Add Resume (top-right) or use upload.html</p>
                            <button onclick="storage.add('Quick Test.pdf')" class="bg-green-600 text-white px-8 py-4 rounded-2xl font-bold shadow-xl hover:shadow-2xl">
                                ğŸ§ª Add Test
                            </button>
                        </div>`;
                    return;
                }
                grid.innerHTML = resumes.map(r => `
                    <div class="group bg-white/90 backdrop-blur-md rounded-3xl shadow-2xl hover:shadow-3xl p-8 relative hover:-translate-y-2 transition-all border-2 hover:border-purple-300">
                        <div class="absolute top-4 left-4">
                            <span class="px-3 py-1 bg-${r.status=='analyzed'?'green':'yellow'}-100 text-${r.status=='analyzed'?'green':'yellow'}-800 text-xs font-bold rounded-full">
                                ${r.status=='analyzed'?'âœ… Analyzed':'â³ Pending'}
                            </span>
                        </div>
                        <div class="w-20 h-20 bg-gradient-to-br ${r.status=='analyzed'?'from-emerald-400 to-teal-500':'from-purple-400 to-pink-500'} rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-2xl group-hover:scale-110">
                            <span class="text-3xl">ğŸ“„</span>
                        </div>
                        <h3 class="font-black text-xl text-gray-800 text-center mb-3 truncate">${r.name}</h3>
                        <div class="space-y-1 mb-6 text-center">
                            <p class="text-xs text-gray-500">${r.date}</p>
                            ${r.score?`<span class="block mx-auto px-3 py-1 bg-gradient-to-r from-${r.score>80?'emerald':r.score>60?'yellow':'red'}-400 to-${r.score>80?'teal':r.score>60?'orange':'pink'}-500 text-white text-sm font-bold rounded-full">${r.score}%</span>`:''}
                            <p class="text-xs text-gray-500">${r.type}</p>
                        </div>
                        <div class="flex gap-3 pt-6 border-t border-gray-100">
                            <button onclick="alert('Analysis: ${r.name} (${r.score||0}%)')" class="flex-1 bg-blue-500 text-white py-3 px-4 rounded-xl font-bold text-sm hover:bg-blue-600 transition-all">
                                ğŸ‘ï¸ View
                            </button>
                            <button onclick="storage.del('${r.id}')" class="w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `).join('');
            },

            stats() {
                document.getElementById('totalResumes').textContent = this.resumes.length;
                document.getElementById('analyzedCount').textContent = this.resumes.filter(r => r.status === 'analyzed').length;
                document.getElementById('pendingCount').textContent = this.resumes.filter(r => r.status === 'pending').length;
                document.getElementById('storageUsed').textContent = `${Math.round(JSON.stringify(this.resumes).length / 1024)}KB`;
            },

            debug() {
                const debugText = document.getElementById('debugText');
                if(debugText) {
                    const saved = localStorage.getItem(this.key);
                    const savedCount = saved ? JSON.parse(saved).length : 0;
                    debugText.textContent = `Storage: ${savedCount} | Memory: ${this.resumes.length}`;
                }
            },

            events() {
                // Test buttons
                document.getElementById('testAdd').onclick = () => this.add('Test Resume ' + Date.now() + '.pdf');
                document.getElementById('testClear').onclick = () => {
                    if(confirm('Clear all?')) {
                        localStorage.removeItem(this.key);
                        this.resumes = [];
                        this.save();
                    }
                };
                document.getElementById('clearAllBtn').onclick = () => {
                    if(confirm('Clear all?')) {
                        localStorage.removeItem(this.key);
                        this.resumes = [];
                        this.save();
                    }
                };
                document.getElementById('searchInput').oninput = (e) => {
                    const filtered = this.resumes.filter(r => r.name.toLowerCase().includes(e.target.value.toLowerCase()));
                    this.render(filtered);
                };

                // Auto-sync from upload.html
                window.addEventListener('storage', (e) => {
                    if(e.key === this.key) this.load();
                });
                window.addEventListener('message', (e) => {
                    if(e.data.type === 'NEW_RESUME') {
                        this.add(e.data.name);
                    }
                });
            }
        };

        // START
        storage.init();
        console.log('âœ… Storage ready! Test buttons top-right.');
    </script>
</body>
</html>
