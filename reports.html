<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Past Reports - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-emerald-50 to-green-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white/90 backdrop-blur-md shadow-xl border-b sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-2xl font-bold text-gray-800 hover:text-green-600 transition-colors">‚Üê Dashboard</a>
                </div>
                <div class="flex space-x-4">
                    <a href="index.html" class="text-gray-700 hover:text-purple-600 font-medium px-4 py-2 rounded-lg transition-all hover:bg-purple-50">Home</a>
                    <a href="profile.html" class="text-gray-700 hover:text-blue-600 font-medium px-4 py-2 rounded-lg transition-all hover:bg-blue-50">Profile</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Test Button - REMOVE AFTER TESTING -->
    <div class="fixed top-4 right-4 z-50">
        <button id="testAdd" class="bg-green-600 text-white px-6 py-3 rounded-2xl font-bold shadow-xl hover:shadow-2xl hover:scale-105 transition-all">
            üß™ Test Add Resume
        </button>
    </div>

    <!-- Advanced Resume Storage Dashboard -->
    <main class="max-w-6xl mx-auto px-6 py-12">
        <!-- Header -->
        <div class="text-center mb-16">
            <h1 class="text-5xl font-black bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 bg-clip-text text-transparent mb-6 drop-shadow-lg">
                üìä Resume Storage
            </h1>
            <p class="text-xl text-gray-700 max-w-2xl mx-auto leading-relaxed">Advanced localStorage system with drag-drop, search, delete, and AI analysis tracking.</p>
        </div>

        <!-- Search & Controls -->
        <div class="bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl p-8 mb-12 border border-white/50">
            <div class="flex flex-col lg:flex-row gap-4 items-center justify-between">
                <div class="relative w-full lg:w-96">
                    <input type="text" id="searchInput" placeholder="üîç Search resumes by name..." 
                           class="w-full pl-12 pr-4 py-4 bg-white/50 border-2 border-gray-200 rounded-2xl focus:border-purple-500 focus:outline-none transition-all text-lg shadow-inner">
                    <div class="absolute left-4 top-4 text-gray-400">üîç</div>
                </div>
                <div class="flex gap-3">
                    <button id="clearAllBtn" class="px-8 py-4 bg-red-500/90 text-white font-bold rounded-2xl hover:bg-red-600 shadow-lg transition-all hover:scale-105">
                        üóëÔ∏è Clear All
                    </button>
                    <a href="upload.html" class="px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold rounded-2xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all">
                        ‚ûï Upload New
                    </a>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid md:grid-cols-4 gap-6 mb-12">
            <div class="bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border border-white/50 hover:shadow-3xl transition-all group">
                <div id="totalResumes" class="text-4xl font-black text-blue-600 mb-2 group-hover:scale-110 transition-transform">0</div>
                <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Total Stored</div>
            </div>
            <div class="bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border border-white/50 hover:shadow-3xl transition-all group">
                <div id="analyzedCount" class="text-4xl font-black text-green-600 mb-2 group-hover:scale-110 transition-transform">0</div>
                <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide">AI Analyzed</div>
            </div>
            <div class="bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border border-white/50 hover:shadow-3xl transition-all group">
                <div id="pendingCount" class="text-4xl font-black text-yellow-500 mb-2 group-hover:scale-110 transition-transform">0</div>
                <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Pending</div>
            </div>
            <div class="bg-white/90 backdrop-blur-md rounded-3xl p-8 shadow-2xl border border-white/50 hover:shadow-3xl transition-all group">
                <div id="storageUsed" class="text-4xl font-black text-purple-600 mb-2 group-hover:scale-110 transition-transform">0KB</div>
                <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide">Storage</div>
            </div>
        </div>

        <!-- Storage Debug -->
        <div id="debugInfo" class="bg-yellow-100 border-2 border-yellow-400 rounded-2xl p-4 mb-8 text-sm hidden">
            <strong>Debug:</strong> <span id="debugText"></span>
        </div>

        <!-- Resume Grid -->
        <div id="resumeGrid" class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            <!-- Dynamic content loads here -->
        </div>
    </main>

    <script>
        class AdvancedResumeStorage {
            constructor() {
                this.key = 'advancedResumes_v2';
                this.resumes = [];
            }

            init() {
                console.log('üöÄ Initializing AdvancedResumeStorage...');
                this.loadResumes();
                this.bindEvents();
            }

            bindEvents() {
                // Search
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => this.searchResumes(e.target.value));
                }

                // Clear all
                const clearBtn = document.getElementById('clearAllBtn');
                if (clearBtn) {
                    clearBtn.addEventListener('click', () => {
                        if(confirm('Delete ALL stored resumes? This cannot be undone.')) {
                            localStorage.removeItem(this.key);
                            this.resumes = [];
                            this.saveResumes();
                            this.renderResumes();
                            this.updateStats();
                        }
                    });
                }

                // Test button
                const testBtn = document.getElementById('testAdd');
                if (testBtn) {
                    testBtn.addEventListener('click', () => {
                        this.addResume('Test Resume ' + Date.now() + '.pdf');
                    });
                }

                // Storage event listener
                window.addEventListener('storage', (e) => {
                    if (e.key === this.key) {
                        console.log('üîÑ Storage event received:', e.newValue ? 'Updated' : 'Cleared');
                        this.loadResumes();
                    }
                });

                // postMessage listener
                window.addEventListener('message', (e) => {
                    console.log('üì® Message received:', e.data);
                    if (e.data && e.data.type === 'NEW_RESUME') {
                        this.addResume(e.data.name || 'Untitled Resume.pdf', e.data.score || 0, e.data.status || 'pending');
                    }
                });

                // Periodic sync check (for GitHub Pages issues)
                setInterval(() => {
                    const saved = localStorage.getItem(this.key);
                    if (saved && JSON.parse(saved).length !== this.resumes.length) {
                        console.log('üîÑ Auto-sync triggered');
                        this.loadResumes();
                    }
                }, 2000);
            }

            loadResumes() {
                try {
                    const saved = localStorage.getItem(this.key);
                    console.log('üíæ Raw storage data:', saved ? saved.substring(0, 100) + '...' : 'empty');
                    
                    if (saved) {
                        this.resumes = JSON.parse(saved);
                        console.log('üì¶ Loaded', this.resumes.length, 'resumes');
                    } else {
                        this.resumes = [];
                        console.log('üì¶ No data found, starting empty');
                    }
                } catch(e) {
                    console.error('‚ùå Storage error:', e);
                    this.resumes = [];
                }
                
                this.renderResumes();
                this.updateStats();
                this.showDebug();
            }

            saveResumes() {
                try {
                    localStorage.setItem(this.key, JSON.stringify(this.resumes.slice(0, 50)));
                    console.log('üíæ Saved', this.resumes.length, 'resumes to storage');
                } catch(e) {
                    console.error('‚ùå Save error:', e);
                }
            }

            addResume(name = 'Untitled Resume.pdf', score = 0, status = 'pending') {
                const resume = {
                    id: Date.now() + Math.random().toString(36).substr(2, 9),
                    name: name,
                    filename: name,
                    date: new Date().toLocaleDateString('en-CA'),
                    score: score,
                    status: status,
                    type: status === 'analyzed' ? 'AI Optimized' : 'New Upload'
                };
                
                console.log('‚ûï Adding resume:', resume);
                this.resumes.unshift(resume);
                this.saveResumes();
                this.renderResumes();
                this.updateStats();
            }

            deleteResume(id) {
                if(confirm('Delete this resume?')) {
                    this.resumes = this.resumes.filter(r => r.id !== id);
                    this.saveResumes();
                    this.renderResumes();
                    this.updateStats();
                }
            }

            searchResumes(query) {
                const filtered = this.resumes.filter(r => 
                    r.name.toLowerCase().includes(query.toLowerCase()) ||
                    r.filename.toLowerCase().includes(query.toLowerCase())
                );
                this.renderResumes(filtered);
            }

            renderResumes(resumesToRender = this.resumes) {
                const grid = document.getElementById('resumeGrid');
                if (!grid) return;
                
                if (resumesToRender.length === 0) {
                    grid.innerHTML = `
                        <div class="md:col-span-full lg:col-span-4 text-center py-24 px-8">
                            <div class="w-32 h-32 bg-gradient-to-br from-gray-200 to-gray-300 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-2xl">
                                <span class="text-5xl">üìÑ</span>
                            </div>
                            <h2 class="text-4xl font-black text-gray-700 mb-4">No Resumes Found</h2>
                            <p class="text-xl text-gray-500 mb-8 max-w-md mx-auto">
                                Click üß™ Test Add Resume (top-right) or upload from upload.html
                            </p>
                            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                                <button onclick="window.storage.addResume('Test Resume.pdf')" 
                                        class="bg-green-600 text-white px-8 py-4 rounded-2xl font-bold shadow-xl hover:shadow-2xl hover:scale-105 transition-all">
                                    üß™ Add Test Resume
                                </button>
                                <a href="upload.html" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-2xl font-bold shadow-xl hover:shadow-2xl hover:scale-105 transition-all">
                                    ‚ûï Upload Real
                                </a>
                            </div>
                        </div>
                    `;
                    return;
                }

                grid.innerHTML = resumesToRender.map(resume => `
                    <div class="group bg-white/90 backdrop-blur-md rounded-3xl shadow-2xl hover:shadow-3xl transition-all duration-500 border-2 hover:border-purple-300 p-8 relative overflow-hidden hover:-translate-y-2">
                        <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-all cursor-grab">
                            <span class="text-gray-400 text-xl">‚ãÆ‚ãÆ</span>
                        </div>
                        
                        <div class="absolute top-4 left-4">
                            <span class="px-3 py-1 bg-${resume.status === 'analyzed' ? 'green' : 'yellow'}-100 text-${resume.status === 'analyzed' ? 'green' : 'yellow'}-800 text-xs font-bold rounded-full shadow-lg">
                                ${resume.status === 'analyzed' ? '‚úÖ AI Analyzed' : '‚è≥ Pending'}
                            </span>
                        </div>

                        <div class="w-20 h-20 bg-gradient-to-br ${resume.status === 'analyzed' ? 'from-emerald-400 to-teal-500' : 'from-purple-400 to-pink-500'} rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-2xl group-hover:scale-110 transition-transform">
                            <span class="text-3xl">üìÑ</span>
                        </div>

                        <h3 class="font-black text-xl text-gray-800 text-center mb-3 truncate group-hover:text-purple-600 transition-colors">${resume.name}</h3>
                        
                        <div class="space-y-1 mb-6 text-center">
                            <p class="text-xs text-gray-500">${resume.date}</p>
                            <div class="flex items-center justify-center gap-2">
                                ${resume.score ? `<span class="px-3 py-1 bg-gradient-to-r from-${resume.score > 80 ? 'emerald' : resume.score > 60 ? 'yellow' : 'red'}-400 to-${resume.score > 80 ? 'teal' : resume.score > 60 ? 'orange' : 'pink'}-500 text-white text-sm font-bold rounded-full shadow-lg">${resume.score}%</span>` : ''}
                            </div>
                            <p class="text-xs text-gray-500 font-medium">${resume.type}</p>
                        </div>

                        <div class="flex gap-3 pt-6 border-t border-gray-100">
                            <button onclick="viewAnalysis('${resume.id}')" 
                                    class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 px-4 rounded-xl font-bold text-sm shadow-lg hover:shadow-xl hover:scale-105 transition-all">
                                üëÅÔ∏è View Analysis
                            </button>
                            <button onclick="downloadResume('${resume.filename}')" 
                                    class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 text-white py-3 px-4 rounded-xl font-bold text-sm shadow-lg hover:shadow-xl hover:scale-105 transition-all">
                                ‚¨áÔ∏è Download
                            </button>
                            <button onclick="window.storage.deleteResume('${resume.id}')" 
                                    class="w-12 h-12 bg-red-500/90 hover:bg-red-600 text-white rounded-xl shadow-lg hover:shadow-xl hover:scale-110 transition-all flex items-center justify-center ml-auto">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            updateStats() {
                document.getElementById('totalResumes').textContent = this.resumes.length;
                document.getElementById('analyzedCount').textContent = this.resumes.filter(r => r.status === 'analyzed').length;
                document.getElementById('pendingCount').textContent = this.resumes.filter(r => r.status === 'pending').length;
                document.getElementById('storageUsed').textContent = `${Math.round(JSON.stringify(this.resumes).length / 1024)}KB`;
            }

            showDebug() {
                const debugDiv = document.getElementById('debugInfo');
                const debugText = document.getElementById('debugText');
                if (debugDiv && debugText) {
                    debugText.textContent = `Storage: ${localStorage.getItem(this.key) ? JSON.parse(localStorage.getItem(this.key)).length : 0} items | Resumes array: ${this.resumes.length}`;
                    debugDiv.classList.remove('hidden');
                }
            }
        }

        // Initialize globally
        window.storage = new AdvancedResumeStorage();

        // Global functions
        function viewAnalysis(id) {
            alert(`Opening analysis for resume ${id}\n\n‚úÖ Storage working perfectly!\n\nConnect your AI analysis here.`);
        }

        function downloadResume(filename) {
            const link = document.createElement('a');
            link.href = `resumes/${filename}`;
            link.download = filename;
            link.click();
        }

        console.log('‚úÖ Advanced Resume Storage v3 READY!');
        console.log('üß™ Click top-right Test button to verify storage works');
        console.log('üíæ Check console for detailed logs');
    </script>
</body>
</html>
